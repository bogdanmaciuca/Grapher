@model Grapher.Models.Project

@{
ViewData["Title"] = "Project Board";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="fw-bold text-dark">@Model.Title</h2>
        <p class="text-muted mb-1">@Model.Description</p>
        <span class="badge bg-light text-dark border">Organizer: @(Model.Organizer?.UserName ?? "Unknown")</span>
    </div>
    <div class="d-flex gap-2">
        <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-outline-secondary rounded-pill px-3">Edit Project</a>
        <a asp-controller="TaskItems" asp-action="Create" asp-route-projectId="@Model.Id" class="btn btn-primary rounded-pill px-4">+ New Task</a>
    </div>
</div>

<hr />

<div class="row">

    <div class="col-md-4">
        <div class="card border-0 shadow-sm mb-3" style="border-radius: 12px; background-color: #f8f9fa;">
            <div class="card-header text-center fw-bold text-secondary bg-transparent border-0">To Do</div>
            <div class="card-body">
                @foreach (var task in Model.Tasks.Where(t => t.Status == Grapher.Models.TaskStatus.NotStarted))
                {
                <div class="card mb-2 shadow-sm">
                    <div class="card-body p-3">
                        <h6 class="card-title mb-1"><a asp-controller="TaskItems" asp-action="Details" asp-route-id="@task.Id" class="text-decoration-none text-dark stretched-link">@task.Title</a></h6>
                        <p class="card-text small text-muted">@($"{task.EndDate:MMM dd}")</p>
                    </div>
                </div>
                }
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card border-0 shadow-sm mb-3" style="border-radius: 12px; background-color: #f8f9fa;">
            <div class="card-header text-center fw-bold text-primary bg-transparent border-0">In Progress</div>
            <div class="card-body">
                @foreach (var task in Model.Tasks.Where(t => t.Status == Grapher.Models.TaskStatus.InProgress))
                {
                <div class="card mb-2 shadow-sm border-primary">
                    <div class="card-body p-3">
                        <h6 class="card-title mb-1"><a asp-controller="TaskItems" asp-action="Details" asp-route-id="@task.Id" class="text-decoration-none text-dark stretched-link">@task.Title</a></h6>
                        <p class="card-text small text-muted">@($"{task.EndDate:MMM dd}")</p>
                    </div>
                </div>
                }
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card border-0 shadow-sm mb-3" style="border-radius: 12px; background-color: #f8f9fa;">
            <div class="card-header text-center fw-bold text-success bg-transparent border-0">Done</div>
            <div class="card-body">
                @foreach (var task in Model.Tasks.Where(t => t.Status == Grapher.Models.TaskStatus.Completed))
                {
                <div class="card mb-2 shadow-sm opacity-75">
                    <div class="card-body p-3">
                        <h6 class="card-title text-decoration-line-through text-muted mb-1">@task.Title</h6>
                        <p class="card-text small text-muted">Finished</p>
                    </div>
                </div>
                }
            </div>
        </div>
    </div>

</div>

<div class="card border-0 shadow-sm mt-4 mb-4" style="border-radius: 12px;">
    <div class="card-header bg-white fw-bold border-0 pt-3 ps-3">Task Dependency Tree (Preview)</div>
    <div class="card-body text-center">
        <div class="mermaid">
            graph TD;
            A[Init Project] --> B(Database Design);
            B --> C{Approval};
            C -->|Yes| D[Backend Dev];
            C -->|No| B;
            D --> E[Frontend Dev];
            E --> F[Deploy];

            style A fill:#f9f,stroke:#333,stroke-width:2px
            style F fill:#ccf,stroke:#333,stroke-width:2px
        </div>
    </div>
</div>

<div class="mt-4">
    <a asp-action="Index" class="btn btn-outline-secondary rounded-pill px-4">Back to Projects List</a>
</div>

@section Scripts {
<script type="module">
import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
mermaid.initialize({ startOnLoad: true });
</script>
}
